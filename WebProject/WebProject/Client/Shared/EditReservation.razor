@inject IJSRuntime JSRuntime
@inject IReservationService ReservationService


<div class="card reservation-card">
    <div class="card-body">
        <h5 class="card-title">Book a ship</h5>
        <h6 class="card-subtitle mb-2 text-muted">Enter the dates for the reservation here:</h6>
        <EditForm Model="@r" OnSubmit="@HandleSubmit">
            <div class="form-group">
                <label>Book from:</label>
                <InputDate @bind-Value="r.FromDate" class="form-control"></InputDate>
            </div>
            <div class="form-group">
                <label>Book until</label>
                <InputDate @bind-Value="r.ToDate" class="form-control"></InputDate>
            </div>
            <div class="form-group">
                <label>Total price: @CalculatePrice() Ft</label>
            </div>
            <button type="submit" class="btn btn-teal">Book this ship </button>
        </EditForm>
    </div>
</div>


@code {
    [Parameter]
    public ApplicationUserDTO PersonLoggedOn { get; set; }

    [Parameter]
    public ShipDTO SelectedShip { get; set; }

    private ReservationPostDTO r = new ReservationPostDTO
    {
        FromDate = DateTime.Today,
        ToDate = DateTime.Today.AddDays(1),
        //TODO get and set the current Ship and Person here
    };


    async void HandleSubmit()
    {
        await JSRuntime.InvokeVoidAsync("console.log", r);

        await ReservationService.CreateReservation(r);
    }

    decimal CalculatePrice()
    {
        TimeSpan timeSpan = r.ToDate - r.FromDate;
        decimal result = numOfWeekdays(timeSpan) * SelectedShip.PriceAtWeekDays;
        result += numOfWeekendDays(timeSpan) * SelectedShip.PriceAtWeekDays;
        Console.WriteLine(SelectedShip.Name);
        return result;
    }

    int numOfWeekdays(TimeSpan timeSpan) //TODO Helyesen kiszamolni a hétköznapok számát
    {
        return timeSpan.Days;
    }

    int numOfWeekendDays(TimeSpan timeSpan)
    {
        return timeSpan.Days - numOfWeekdays(timeSpan);
    }
}
